<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mentee Chat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .chat {
      display: none;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      width: 300px;
    }
    .messages {
      border: 1px solid #ccc;
      height: 200px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <h1>Mentee Chat</h1>
  
  <p>Select a mentor to chat with:</p>
  
  <button id="mentor1" data-mentorid="mentor1">Chat with Mentor 1</button>
  <button id="mentor2" data-mentorid="mentor2">Chat with Mentor 2</button>

  <!-- Chat box for Mentor 1 -->
  <div id="chatMentor1" class="chat">
    <h2>Chat Room: Mentor 1</h2>
    <div class="messages" id="messagesMentor1"></div>
    <input id="messageInputMentor1" type="text" placeholder="Type your message...">
    <button id="sendMessageMentor1">Send</button>
  </div>

  <!-- Chat box for Mentor 2 -->
  <div id="chatMentor2" class="chat">
    <h2>Chat Room: Mentor 2</h2>
    <div class="messages" id="messagesMentor2"></div>
    <input id="messageInputMentor2" type="text" placeholder="Type your message...">
    <button id="sendMessageMentor2">Send</button>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io('http://localhost:3000'); // Ensure this matches your server address

    const menteeId = 'mentee123'; // Assume the mentee has this ID
    const buttons = document.querySelectorAll('button[data-mentorid]');
    
    // Add event listener to each mentor button
    buttons.forEach(button => {
      button.addEventListener('click', function() {
        const mentorId = this.getAttribute('data-mentorid');
        const roomId = `${mentorId}_${menteeId}`; // Create unique room ID
        
        // Emit joinRoom event to the server with the roomId and IDs
        socket.emit('joinRoom', { mentorId, menteeId });
        
        // Hide other chats and display the current one
        document.querySelectorAll('.chat').forEach(chat => chat.style.display = 'none');
        document.getElementById(`chat${mentorId.charAt(0).toUpperCase() + mentorId.slice(1)}`).style.display = 'block';
        
        // Listen for messages for the selected mentor
        setupChatListeners(mentorId, roomId);
      });
    });

    function setupChatListeners(mentorId, roomId) {
      const messagesDiv = document.getElementById(`messages${mentorId.charAt(0).toUpperCase() + mentorId.slice(1)}`);
      const messageInput = document.getElementById(`messageInput${mentorId.charAt(0).toUpperCase() + mentorId.slice(1)}`);
      const sendMessageBtn = document.getElementById(`sendMessage${mentorId.charAt(0).toUpperCase() + mentorId.slice(1)}`);
      
      // Listen for messages from the server
      socket.on('message', (data) => {
        if (data.roomId === roomId) {
          const messageElement = document.createElement('div');
          messageElement.textContent = `${data.sender}: ${data.message}`;
          messagesDiv.appendChild(messageElement);
          messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to the bottom
        }
      });

      // Handle sending a message
      sendMessageBtn.addEventListener('click', () => {
        const message = messageInput.value;
        if (message) {
          socket.emit('message', { roomId, message });
          messageInput.value = ''; // Clear the input field
        }
      });
      
      // Optional: Listen for room status messages
      socket.on('roomJoined', (message) => {
        const messageElement = document.createElement('div');
        messageElement.textContent = `System: ${message}`;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll
      });

      socket.on('roomFull', (message) => {
        alert(message); // Notify the user if the room is full
      });

      socket.on('userLeft', (message) => {
        const messageElement = document.createElement('div');
        messageElement.textContent = `System: ${message}`;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll
      });
    }
  </script>
</body>
</html>
